<ng-container *ngIf="entity">
  <ng-template [ngTemplateOutlet]="avatar"></ng-template>
  <div class="m-suggestedPanelCard__bodyContainer" #bodyContainer>
    <span class="m-suggestedPanelCard__name">
      {{ name }}
    </span>
    <span class="m-suggestedPanelCard__description">
      {{ description }}
    </span>
    <div
      *ngIf="hovering$ | async"
      class="m-suggestedPanelCard__hoverCardContainer"
      [ngStyle]="cardTopStyle"
    >
      <!-- Hover card -->
      <div class="m-hoverCard__topbar">
        <ng-template [ngTemplateOutlet]="avatar"></ng-template>
        <div class="m-hoverCard__namePanel">
          <a
            class="m-suggestedPanelCard__link--undecorated"
            [href]="url"
            target="_blank"
          >
            <span class="m-hoverCard__name">
              {{ name }}
            </span>
          </a>
          <a
            class="m-suggestedPanelCard__link--undecorated"
            [href]="url"
            target="_blank"
          >
            <span
              class="m-hoverCard__username"
              *ngIf="entity.type !== 'group' && entity.username"
            >
              @{{ username }}
            </span>
          </a>
        </div>
        <ng-template [ngTemplateOutlet]="interactButton"></ng-template>
      </div>
      <div class="m-hoverCard__body">
        <div class="m-hoverCard__subCountsContainer" [ngSwitch]="entity.type">
          <ng-container *ngSwitchCase="'user'">
            <span class="m-hoverCard__subscriberCount--primary">{{
              subscribersCount
            }}</span>
            <span class="m-hoverCard__subscriberCount--secondary">
              subscribers Â·
            </span>
            <span class="m-hoverCard__subscriberCount--primary">{{
              subscriptionsCount
            }}</span>
            <span class="m-hoverCard__subscriberCount--secondary">
              subscriptions</span
            >
          </ng-container>
          <ng-container *ngSwitchCase="'group'">
            <span class="m-hoverCard__subscriberCount--primary">{{
              membershipCount
            }}</span>
            <span class="m-hoverCard__subscriberCount--secondary">
              members
            </span>
          </ng-container>
        </div>
        <div class="m-hoverCard__hashtagsContainer">
          <a
            *ngFor="let hashtag of hashtags"
            class="m-suggestedPanelCard__link--undecorated"
            [href]="'/discovery/search?f=top&t=all&q=%23' + hashtag"
            target="_blank"
            >#{{ hashtag }}
          </a>
        </div>
        <span class="m-hoverCard__description">{{ description }}</span>
      </div>
    </div>
  </div>
  <ng-template [ngTemplateOutlet]="interactButton"></ng-template>
</ng-container>

<ng-template #interactButton>
  <div class="m-suggestedPanelCard__subscribeButtonContainer">
    <div
      class="m-suggestedPanelCard__subscribeButton"
      (click)="onActionToggle()"
    >
      <!-- + symbol -->
      <i
        *ngIf="!isSubscribed && !(actionInProgress$ | async)"
        class="material-icons"
        >add</i
      >
      <!-- checkmark symbol -->
      <i
        *ngIf="isSubscribed && !(actionInProgress$ | async)"
        class="material-icons m-suggestedPanelCard__subscribeButton--subscribed"
        >done</i
      >
      <!-- in progress -->
      <i
        *ngIf="actionInProgress$ | async"
        class="material-icons m-suggestedPanelCard__subscribeButton--subscribed"
        >more_horiz</i
      >
    </div>
  </div>
</ng-template>

<ng-template #avatar>
  <a class="m-suggestedPanelCard__avatarContainer" [href]="url" target="_blank">
    <img [src]="avatarUrl" class="m-suggestedPanelCard__avatar" />
  </a>
</ng-template>
